<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reloj Minimalista</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<style>
  body {
    margin:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
    height:100vh; font-family: monospace; background:#000; color:#0f0; transition: background 0.3s, color 0.3s;
  }
  #clock { font-size: 5rem; letter-spacing: 4px; }
  .controls { margin-top: 20px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
  label { font-size: 0.9rem; }
</style>
</head>
<body>

<div id="clock"></div>

<div class="controls">
  <label>Formato:
    <select id="format">
      <option value="24">24h</option>
      <option value="12">12h</option>
    </select>
  </label>
  <label>Fuente:
    <select id="font">
      <option value="monospace">Monospace</option>
      <option value="sans-serif">Sans Serif</option>
      <option value="serif">Serif</option>
      <option value="'Courier New', monospace">Courier</option>
    </select>
  </label>
  <label>Color números:
    <input type="color" id="color" value="#00ff00">
  </label>
  <label>Color fondo:
    <input type="color" id="bgcolor" value="#000000">
  </label>
  <label>Alarma:
    <input type="time" id="alarmTime">
  </label>
  <button id="setAlarm">Activar</button>
  <button id="clearAlarm">Quitar</button>
</div>

<audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

<script>
const clock = document.getElementById('clock');
const formatSel = document.getElementById('format');
const fontSel = document.getElementById('font');
const colorSel = document.getElementById('color');
const bgSel = document.getElementById('bgcolor');
const alarmInput = document.getElementById('alarmTime');
const alarmSound = document.getElementById('alarmSound');

let alarmTime = null;
let alarmActive = false;

// Cargar preferencias
if(localStorage.getItem('prefs')){
  const prefs = JSON.parse(localStorage.getItem('prefs'));
  formatSel.value = prefs.format;
  fontSel.value = prefs.font;
  colorSel.value = prefs.color;
  bgSel.value = prefs.bg;
  document.body.style.fontFamily = prefs.font;
  document.body.style.color = prefs.color;
  document.body.style.backgroundColor = prefs.bg;
}

function savePrefs(){
  localStorage.setItem('prefs', JSON.stringify({
    format: formatSel.value,
    font: fontSel.value,
    color: colorSel.value,
    bg: bgSel.value
  }));
}

function updateClock(){
  const now = new Date();
  let hours = now.getHours();
  let minutes = now.getMinutes();
  let seconds = now.getSeconds();
  let ampm = '';

  if(formatSel.value === '12'){
    ampm = hours >= 12 ? ' PM' : ' AM';
    hours = hours % 12 || 12;
  }

  const timeStr = 
    String(hours).padStart(2,'0') + ':' +
    String(minutes).padStart(2,'0') + ':' +
    String(seconds).padStart(2,'0') + ampm;

  clock.textContent = timeStr;

  if(alarmActive && alarmTime){
    const current = now.toTimeString().slice(0,5);
    if(current === alarmTime){
      alarmSound.play();
      alarmActive = false;
      alert('⏰ ¡Alarma!');
    }
  }
}

setInterval(updateClock, 1000);
updateClock();

formatSel.addEventListener('change', ()=>{ updateClock(); savePrefs(); });
fontSel.addEventListener('change', ()=>{ document.body.style.fontFamily = fontSel.value; savePrefs(); });
colorSel.addEventListener('input', ()=>{ document.body.style.color = colorSel.value; savePrefs(); });
bgSel.addEventListener('input', ()=>{ document.body.style.backgroundColor = bgSel.value; savePrefs(); });

document.getElementById('setAlarm').addEventListener('click', ()=>{
  if(alarmInput.value){
    alarmTime = alarmInput.value;
    alarmActive = true;
    alert('Alarma configurada para ' + alarmTime);
  }
});
document.getElementById('clearAlarm').addEventListener('click', ()=>{
  alarmTime = null;
  alarmActive = false;
  alert('Alarma eliminada');
});
</script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(() => console.log("SW registrado"))
    .catch(err => console.error("Error SW:", err));
}
</script>

</body>
</html>